
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="Chambre De Commerce companies search app" content="">
    <meta name="Salomey Osei" content="">

  <title>Chambre de commerce</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/dashboard.css">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <!-- Modal for map display-->
<div class="modal fade" id="generalMapView" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Chambre de commerce</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body google-mapsframe">
        <div id="map" class="google-maps"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close/Fermer</button>

      </div>
    </div>
  </div>
</div>
<!--/General map view  -->
<!-- Single map view -->
<div class="modal fade " id="singleMap" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title updatecompanyHeader" id="exampleModalLabel ">map view/vue carte</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row row-fluid">
          <div class="col-lg-12">
            <h4 id="raison"></h4>
  <address>
  Nom du Représentant:  <strong><span id="rname"></span></strong><br>
  Localisation # <span id="lc"></span><br>
  B.P # <span id="bp"></span><br>
  Telephone: <span id="tel"></span><br>
  E-mail: <span id="email"></span><br>
  N° Contribuable: <span id="tax"></span><br>
  Geolocation<br>
  Longitude (<span id="Lon"></span>)<br>
  Latitude (<span id="Lat"></span>)<br>
  </address>
</div>
<div class="col-lg-12">
  <div style="margin-bottom:10px">
    <div class="row">
      <div class="col-md-4">
        <button class="mview" type="button" onclick="popSingleMap(this.id)" >map view/vue carte</button>&nbsp;
        <button class="sview" type="button" onclick="streetView(this.id)">street view/vue rue</button>
      </div>
      <div class="col-md-7">
        <p class="invisible" id="label">click anywhere on the street to have a street view/
cliquez n'importe où dans la rue pour avoir une vue sur la rue</p>
      </div>
    </div>

  </div>
<div class="row">
  <div class="col-md-6" style="padding:0px;margin:0px;height: 500px;" id="single-map">

  </div>
  <div class="col-md-6 invisible" style="padding:0px;margin:0px;height: 500px;" id="pano">

  </div>
</div>
</div>
</div>

</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close/Fermer</button>
</div>
</div>
</div>
</div>
<!--/Single map view -->
<!-- update company -->
<div class="modal fade " id="updatecompany" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title updatecompanyHeader" id="exampleModalLabel ">Updates/Actualiser</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 well" >
            <form class="" action="/ccima.cm/searchCompanies/updatesCompanies" method="post">
              <input type="hidden" name="cid" id="cid">
                <div class="col-sm-12">
                  <div class="row">
                    <div class="col-sm-6 form-group">
                      <label>Raison Sociale </label>
                      <input type="text" name="raison" id="uraison" class="form-control" placeholder="Raison Sociale" tabindex="3">
                    </div>
                    <div class="col-sm-6 form-group">
                      <label>Nom du Représentant</label><i>
                      <input type="text" name="rname" id="urname" class="form-control " placeholder="Nom du Représentant" tabindex="4">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-6 form-group">
                      <label>Localisation</label>
                      <input type="text" name="lc" id="ulc" class="form-control" placeholder="Localisation" tabindex="3">
                    </div>
                    <div class="col-sm-6 form-group">
                      <label>B.P</label><i>
                      <input type="text" name="bp" id="ubp" class="form-control " placeholder="B.P" tabindex="4">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-6 form-group">
                      <label>Telephone</label>
                      <input type="text" name="tel" id="utel" class="form-control" placeholder="Telephone" tabindex="3">
                    </div>
                    <div class="col-sm-6 form-group">
                      <label>E-mail</label><i>
                      <input type="text" name="email" id="uemail" class="form-control " placeholder="E-mail" tabindex="4">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12 form-group">
                      <label>N° Contribuable</label><i>
                      <input type="text" name="tax" id="utax" class="form-control " placeholder="N° Contribuable" tabindex="4">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12"><label for="">Geolocalisation</label></div>
                    <div class="col-xs-12 col-sm-6 col-md-6">
                      <div class="form-group">
                        Longitude
                        <input type="text" name="longitude" id="ulongitude" class="form-control " placeholder="(eg: 6.673159099999999)" tabindex="5">
                      </div>
                    </div>
                    <div class="col-xs-12 col-sm-6 col-md-6">
                      <div class="form-group">
                        Latitude
                        <input type="text" name="latitude" id="ulatitude" class="form-control" placeholder="(eg: -1.5654015000000072)" tabindex="6">
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <input type="submit" name="update" value="Update" class="btn btn-primary btn-block btn-lg">
                  </div>
                </div>
              </form>
          </div>
        </div>

      </div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close/Fermer</button>
</div>
</div>
</div>
</div>

<!--/update company  -->
<!-- update company err -->
<div class="modal fade " id="updatecompanyErr" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title updatecompanyHeader" id="exampleModalLabel ">Update</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 well" >
            <form class="" action="/ccima.cm/searchCompanies/updatesCompanies" method="post">
              <input type="hidden" name="cid" id="checkupdate"  <% if( typeof cid != 'undefined'){ %>value =" <%= cid %> "<% } %>>
                <div class="col-sm-12">
                  <div class="row">
                    <div class="col-sm-6 form-group">
                      <label>Raison Sociale </label>
                      <% if( typeof raisonValidationErr != 'undefined'){ %><i class="err_msg"><%= raisonValidationErr %><% } %></i>
                      <input type="text" name="raison"  class="form-control" tabindex="3" id="er2uraison" placeholder="Raison Sociale">

                    </div>
                    <div class="col-sm-6 form-group">
                      <label>Nom du Représentant</label><i>
                        <% if( typeof rnameValidationErr != 'undefined'){ %><i class="err_msg"><%= rnameValidationErr %><% } %></i>
                      <input type="text" name="rname" class="form-control "  tabindex="4"  id="er2urepresentative_name" placeholder="Nom du Représentant">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-6 form-group">
                      <label>Localisation</label>
                      <% if( typeof lcValidationErr != 'undefined'){ %><i class="err_msg"><%= lcValidationErr %><% } %></i>
                      <input type="text" name="lc" class="form-control"  tabindex="3" id="er2ulocation" placeholder="Localisation">
                    </div>
                    <div class="col-sm-6 form-group">
                      <label>B.P</label>
                      <% if( typeof bpValidationErr != 'undefined'){ %><i class="err_msg"><%= bpValidationErr %><% } %></i>
                      <input type="text" name="bp" class="form-control " tabindex="4" id="er2ubp" placeholder="B.P">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-6 form-group">
                      <label>Telephone</label>
                      <% if( typeof telValidationErr != 'undefined'){ %><i class="err_msg"><%= telValidationErr %><% } %></i>
                      <input type="text" name="tel"  class="form-control"  tabindex="3" id="er2utel" placeholder="Telephone">
                    </div>
                    <div class="col-sm-6 form-group">
                      <label>E-mail</label><i>
                      <input type="text" name="email" class="form-control " tabindex="4" id="er2uemail" placeholder="E-mail">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12 form-group">
                      <label>N° Contribuable</label>
                      <% if( typeof taxValidationErr != 'undefined'){ %><i class="err_msg"><%= taxValidationErr %><% } %></i>
                      <input type="text" name="tax" class="form-control " tabindex="4" id="er2utax_number" placeholder="N° Contribuable">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12"><label for="">Geolocalisation</label></div>
                    <div class="col-xs-12 col-sm-6 col-md-6">
                      <div class="form-group">
                        Longitude
                        <input type="text" name="longitude"class="form-control "  tabindex="5" id="er2ulongitude" placeholder="longitude">
                      </div>
                    </div>
                    <div class="col-xs-12 col-sm-6 col-md-6">
                      <div class="form-group">
                        Latitude
                        <input type="text" name="latitude" class="form-control"  tabindex="6" id="er2ulatitude" placeholder="latitude">
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <input type="submit" name="update" value="Update" class="btn btn-primary btn-block btn-lg">
                  </div>
                </div>
              </form>
          </div>
        </div>

      </div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close/Fermer</button>
</div>
</div>
</div>
</div>
<!--/update company err -->
<!-- delete company -->

<!-- Modal -->
<div class="modal fade" id="deletecompany" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel"> <i class="fa fa-exclamation-triangle text-danger"></i> Delete/Effacer<span id="delcnamehd"></span></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h4 class="text-warning">Are you sure you want to delete/Voullez vous vraiment suprimer <span id="delcname"></span> ?</h4>
        <p class="text-warning">Caution! All company information will be deleted/Attention! Tout les information de l'entreprise vont etre suprimer </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">No/Non</button>
        <a onclick="deleteresponse()" id="del"><button type="button" class="btn btn-danger" >Yes/
Oui</button></a>
      </div>
    </div>
  </div>
</div>
<!-- /delete company -->

<!-- Update user settings -->
<!-- Modal -->
<div class="modal fade" id="Usersettings" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel"> <i class="fa fa-exclamation-triangle text-danger"></i> Settings/Réglages <span id="delunamehd"></span></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12">
            <form class="form-inline">
              <h4 style="text-align:center;margin:30px 0px;">Username Update/Mise à jour du nom d'utilisateur</h4>
    <div class="form-group">

      <input type="text"  class="form-control mx-sm-3" id="oldusername" placeholder="username/
nom d'utilisateur">

    </div><br>
  <div class="form-group"><br>

    <input type="text"  class="form-control mx-sm-3" id="newusername" placeholder="new username/nouveau nom d'utilisateur">

    <button type="button" name="button" class="btn btn-primary" onclick="UpdateUsername()">Save/
Enregistrer</button>
    <span id="usernameErr" style="color:red"></span><span id="usernameSuccess" style="color:green"></span>
  </div>
</form>
          </div>
          <div class="col-md-12">
            <h4 style="text-align:center;margin:30px 0px;">Update password/Changer mot de passe</h5>
            <form>
              <div class="form-row">
                <div class="form-group col-md-12">
                  <h5>Current password/Mot de passe actuel</h5>
                  <input type="password" class="form-control"  placeholder="current password/mot de passe actuel" id="currentpwrd">
                </div>
                <div class="form-group col-md-12">
                  <h5>New password/Nouveau mot de passe</h5>
                  <input type="password" class="form-control" placeholder="new password/nouveau mot de passe" id="newpwrd">
                </div>
                <div class="form-group col-md-12">
                  <h5 for="inputEmail4">Re enter new password/Ré-entrez le nouveau mot de passe</h5>
                  <input type="password" class="form-control"  placeholder="re enter new password/ré-entrez le nouveau mot de passe" id="re_pwrd">
                  <span id="passwordErr" style="color:red"></span><span id="passwordSuccess" style="color:green"></span>
                </div>
                <div class="form-group col-md-6"><br>
                  <button type="button" name="button" class="btn btn-primary" onclick="UpdateUserPassword()">Update/Actualiser</button>

                </div>
              </div>

            </form>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close/Fermer</button>

      </div>
    </div>
  </div>
</div>
<!-- /Update user settings -->

<!-- Static navbar -->
      <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">CHAMBRE DE COMMERCE</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="fa fa-user"></i>  
                <% if(user){ %><%= user.fname %><% } %> <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li class="hidden" id="userid"><% if(user){ %><%= user.id %> <% } %></li>
                  <li id="adminPriority" class="hidden"><% if(user){ %><%= user.Admintype %> <% } %></li>
                  <li><a href="#"><% if(user){ %><%= user.fname %> <%= user.lname %><% } %></a></li>
                  <li><a href="#"><% if(user){ %><%= user.email %><% } %></a></li>
                  <li><a href="#" data-toggle="modal" data-target="#Usersettings">Settings</a></li>
                  <li role="separator" class="divider"></li>
                  <li><a href="/logout"><i class="glyphicon glyphicon-log-out"></i> Sign out</a></li>

                </ul>
              </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </nav>
<!-- Page Content -->
<div class="container">

      <div class="row row-offcanvas row-offcanvas-right">
        <div class="col-md-3  sidebar-offcanvas" id="sidebar">
          <div class="list-group">
            <a href="/ccima.cm/staffroom/home" class="list-group-item active" >Companies</a>
            <a href="/ccima.cm/staffroom/home/registered_users" class="list-group-item">Users</a>
            <a href="/ccima.cm/staffroom/home/registerCompanies" class="list-group-item">Register Companies</a>

            <% if(user){ %>
              <% if(user.Admintype =='Super Admin'){ %>
                <a href="/ccima.cm/staffroom/home/users" class="list-group-item" id="regUser" >Register Users</a>
              <% } %>
              <% } %>
          </div>
        </div><!--/.sidebar-offcanvas-->
        <div class="col-sm-9">
          <div class="row " style="margin-bottom:50px">
            <%- messages('message',locals) %>

            <div class="col-md-6">
              <button type="button" name="button"  class="btn btn-success"  data-toggle="modal" data-target="#generalMapView" onclick="popGeneralMap()" id="general"> <i class="glyphicon glyphicon-map-marker"></i> Map view/Vue carte</button>
            </div>
            <div class="col-md-6">
              <form class="navbar-form navbar-right">
                <input type="text" class="form-control " placeholder="Search/
Rechercher..." id="companyserarchfield" onkeyup="companySearch()" name="">
              </form>
            </div>
          </div>
          <div class="col-md-12">
              <!--List companies  -->
              <h5 id="h">Chambre de Comerce Registered Businesses Search App</h5>
              <p id="searchresult" class="hidden"></p>
              <p id="output" class="hidden"></p>
              <table class="table table-striped hidden" id="tablemain">
                <tbody id="emp_body"></tbody>
              </table>

          </div>
          <ul class="pagination justify-content-center" id="pagination"></ul>
        </div><!--/.col-xs-12.col-sm-9-->


      </div><!--/row-->

    </div><!--/.container-->
    <!-- Footer -->
    <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; 2018</p>
      </div>
      <!-- /.container -->
    </footer>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script type="text/javascript" src="/bower_components/jquery/dist/jquery.twbsPagination.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="\bower_components\bootstrap\dist\js\typeahead.bundle.js"></script>
    <script type="text/javascript" src="\bower_components\bootstrap\dist\js\dashboard.js"></script>
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBlNlnEIzSVoUE2PRF79vWaxjx0HyRFFmo&callback=initialize"></script>
  <script type="text/javascript">
  // Page pagination
  var get_records = <%-JSON.stringify(companies)%>
  var $pagination = $('#pagination'),
  totalRecords = 0,
  records = [],
  displayRecords = [],
  recPerPage = 10,
  page = 1,
  totalPages = 0;

  records = get_records;
  totalRecords = records.length;
  totalPages = Math.ceil(totalRecords / recPerPage);

  function generate_table() {
      var tr;
      $('#emp_body').html('');
      var Adminpriorities = document.getElementById("adminPriority").innerHTML;

      for (var i = 0; i < displayRecords.length; i++) {
        if(Adminpriorities != 'Super Admin '){
        tr = $("<tr><td><div class=\"row\"><div class=\"col-md-8\"><h5 class=\"media-heading\"><i class=\"fa fa-calendar text-muted\"></i> "+displayRecords[i].raison +"<small class=\"text-muted\"> @"+displayRecords[i].creation_date+"</small></h5><br><small class=\"text-muted\"> [ B.P: ] "+displayRecords[i].bp +"</small><br><small class=\"text-muted\">[ <i class=\"fa fa-phone-square\"></i> TEL: ] "+displayRecords[i].tel+"</small><br><small class=\"text-muted\">[ <i class=\"fa fa-envelope\"></i> E-mail: ] "+displayRecords[i].email+"</small></div><div class=\"col-md-4\"><a id="+displayRecords[i].id +" onclick=\"popSingleMap(this.id)\"><button class=\"btn btn-primary btn-sm\" value=\"right\" type=\"button\"><i class=\"glyphicon glyphicon-map-marker\"></i> mapview </button></a></div></div>");
        $('#emp_body').append(tr);
      }else{
        tr = $("<tr><td><div class=\"row\"><div class=\"col-md-8\"><h5 class=\"media-heading\"><i class=\"fa fa-calendar text-muted\"></i> "+displayRecords[i].raison +"<small class=\"text-muted\"> @"+displayRecords[i].creation_date+"</small></h5><br><small class=\"text-muted\"> [ B.P: ] "+displayRecords[i].bp +"</small><br><small class=\"text-muted\">[ <i class=\"fa fa-phone-square\"></i> TEL: ] "+displayRecords[i].tel+"</small><br><small class=\"text-muted\">[ <i class=\"fa fa-envelope\"></i> E-mail: ] "+displayRecords[i].email+"</small></div><div class=\"col-md-4\"><a id="+displayRecords[i].id +" onclick=\"popSingleMap(this.id)\"><button class=\"btn btn-primary btn-sm\" value=\"right\" type=\"button\"><i class=\"glyphicon glyphicon-map-marker\"></i> mapview </button></a><button class=\"btn btn-default btn-sm updateclass\" value=\"right\" type=\"button\" id="+displayRecords[i].id +" onclick=\"UpdateCompany(this.id)\"><i class=\"fa fa-fw fa-cog\"></i> update</button><a id="+displayRecords[i].id+" onclick=\"deleteCompany(this.id)\" ><button class=\"btn btn-danger btn-sm \" value=\"left\" type=\"button\"><i class=\"glyphicon glyphicon-trash\"></i> delete</button></a></div></div>");
        $('#emp_body').append(tr);
      }

    }
  }
  function apply_pagination() {
      $pagination.twbsPagination({
            totalPages: totalPages,
            visiblePages: 6,
            onPageClick: function (event, page) {
                  displayRecordsIndex = Math.max(page - 1, 0) * recPerPage;
                  endRec = (displayRecordsIndex) + recPerPage;

                  displayRecords = records.slice(displayRecordsIndex, endRec);
                  generate_table();
            }
      });
  }
  apply_pagination();
  </script>
      <script>
      $(document).ready(function(){
        // show genral map with all companies locations
        popGeneralMap();
        // show single modal with individual company location
        popSingleMap();





      });
      // general map

      // 4.0681364, 9.71072730000003
      function popGeneralMap(){
      var rows =<%-JSON.stringify(companies)%>
      var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 6.3,
      center: new google.maps.LatLng(7.3696495,12.3445856),
      mapTypeId: google.maps.MapTypeId.ROADMAP
      });
      var infowindow = new google.maps.InfoWindow();
      var marker, i;
      for (i = 0; i < rows.length; i++) {
      marker = new google.maps.Marker({
      position: new google.maps.LatLng(rows[i].longitude, rows[i].latitude),
      animation: google.maps.Animation.BOUNCE,
      map: map
      });
      google.maps.event.addListener(marker, 'click', (function (marker, i) {
      return function () {
      infowindow.setContent(rows[i][0]);
      infowindow.open(map, marker);
      }
      })(marker, i));
      }
    }

  // single map
  var counter = 0;
    var companyname = '';
      function popSingleMap(companyID) {
        $('p#label').addClass('invisible');
        $('#pano').addClass('invisible');

      var rows =<%-JSON.stringify(companies)%>
      var longitude='';
      var latitude = '';
      for (i = 0; i < rows.length; i++) {

          if(rows[i].id == companyID){
          document.getElementById('raison').innerHTML = rows[i].raison;
          document.getElementById('rname').innerHTML = rows[i].representative_name;
          document.getElementById('lc').innerHTML = rows[i].location;
          document.getElementById('bp').innerHTML = rows[i].bp;
          document.getElementById('tel').innerHTML = rows[i].tel;
          document.getElementById('email').innerHTML = rows[i].email;
          document.getElementById('tax').innerHTML = rows[i].tax_number;
          document.getElementById('Lon').innerHTML = rows[i].longitude;
          document.getElementById('Lat').innerHTML = rows[i].latitude;
          $('button.mview').attr('id', rows[i].id);
          $('button.sview').attr('id', rows[i].id);
          longitude = rows[i].longitude;
          latitude = rows[i].latitude;
          companyname = rows[i].raison;
          }
        }
        // maps
        var myCenter = new google.maps.LatLng(longitude,latitude);
        var mapCanvas = document.getElementById("single-map");
        var mapOptions = {
        center: myCenter,
        zoom: 14,
        };
        var map = new google.maps.Map(mapCanvas, mapOptions);
        var marker = new google.maps.Marker({
          position:myCenter,
          animation: google.maps.Animation.BOUNCE,

        });
        var infowindow = new google.maps.InfoWindow({
        content: companyname
      });
        infowindow.open(map,marker);
        marker.setMap(map);

        // display single map modal

        showsinglemapmodal(counter);
        counter=counter+1;

      }
      function showsinglemapmodal(counter) {
        if(counter>1){
          $("#singleMap").modal();

        }

      }
      // street view function

    var map;
  var panorama;
  function streetView(thisid) {
    $('p#label').removeClass('invisible');
    $('#pano').removeClass('invisible');
    // document.getElementById('pano').innerHTML =" preview street view here";
        var rows =<%-JSON.stringify(companies)%>

      var Longitude ='';
      var Latitude   =  '';
      for(var i=0; i<rows.length;i++){
        if(rows[i].id == thisid){
          Longitude = rows[i].longitude;
          Latitude = rows[i].latitude;
        }

      }

      var cammeroon = {lat: parseFloat( Longitude )  , lng: parseFloat( Latitude )};

    // var berkeley = {lat: 6.673164499999999, lng: -1.5670537999999397};
    var sv = new google.maps.StreetViewService();

    panorama = new google.maps.StreetViewPanorama(document.getElementById('pano'));

    // Set up the map.
    map = new google.maps.Map(document.getElementById('single-map'), {
      center: cammeroon,
      zoom: 16,
      streetViewControl: false
    });

    // Set the initial Street View camera to the center of the map
    sv.getPanorama({location: cammeroon, radius: 50}, processSVData);

    // Look for a nearby Street View panorama when the map is clicked.
    // getPanorama will return the nearest pano when the given
    // radius is 50 meters or less.
    map.addListener('click', function(event) {
      sv.getPanorama({location: event.latLng, radius: 50}, processSVData);
    });
  }
  function processSVData(data, status) {
    if (status === 'OK') {

      var marker = new google.maps.Marker({
        position: data.location.latLng,
        map: map,
        title: data.location.description
      });

      panorama.setPano(data.location.pano);
      panorama.setPov({
        heading: 270,
        pitch: 0
      });
      panorama.setVisible(true);

      marker.addListener('click', function() {
        var markerPanoID = data.location.pano;
        // Set the Pano to use the passed panoID.
        panorama.setPano(markerPanoID);
        panorama.setPov({
          heading: 270,
          pitch: 0
        });
        panorama.setVisible(true);
      });
    } else {
      console.error('Street View data not found for this location.');
    }
  }
    // initialize multiple functions for google map API KEY
    function initialize() {
       popGeneralMap();
       popSingleMap();
       streetView();
    }

  //show modal for company update
  function UpdateCompany(id) {

  var rows =<%-JSON.stringify(companies)%>
  for (i = 0; i < rows.length; i++) {

    if(rows[i].id == id){
      document.getElementById('cid').value = rows[i].id;
      document.getElementById('uraison').value = rows[i].raison;
      document.getElementById('urname').value = rows[i].representative_name;
      document.getElementById('ulc').value = rows[i].location;
      document.getElementById('ubp').value = rows[i].bp;
      document.getElementById('utel').value = rows[i].tel;
      document.getElementById('uemail').value = rows[i].email;
      document.getElementById('utax').value = rows[i].tax_number;
      document.getElementById('ulongitude').value = rows[i].longitude;
      document.getElementById('ulatitude').value = rows[i].latitude;

    }

  }


    $("#updatecompany").modal();
  }
  function checkUpdateOption() {
  var update = document.getElementById('checkupdate').value;
  if(update.length > 0){
    $('#updatecompanyErr').modal();
  }
  }
  //show company update error modal if anywhere
  checkUpdateOption();

  // delete company
  var deleteresponse = '';
  var cid = '';
  var deleteCompany = function (delid) {
    var list =<%-JSON.stringify(companies)%>
    var company = '';
    for (i = 0; i < list.length; i++){

      if(list[i].id == delid){
        company = list[i].raison;
        cid = list[i].id;
      }
    }
    document.getElementById('delcname').innerHTML = company;
    document.getElementById('delcnamehd').innerHTML = company;

    $('#del').attr('href','/chamberedecommerce.com/staffroom/home/delete/'+cid);
    $("#deletecompany").modal();

  }

  <% if( typeof secrepNames != 'undefined'){ %>
  var getsecrepNames = <%-JSON.stringify(secrepNames)%>
  document.getElementById('er2uraison').value = getsecrepNames.raison;
  document.getElementById('er2urepresentative_name').value = getsecrepNames.rname;
  document.getElementById('er2ulocation').value = getsecrepNames.lc;
  document.getElementById('er2ubp').value = getsecrepNames.bp;
  document.getElementById('er2utel').value = getsecrepNames.tel;
  document.getElementById('er2uemail').value = getsecrepNames.email;
  document.getElementById('er2utax_number').value = getsecrepNames.tax;
  document.getElementById('er2ulongitude').value = getsecrepNames.longitude;
  document.getElementById('er2ulatitude').value = getsecrepNames.latitude;
  $('#updatecompanyErr').modal();
   <% } %>

      </script>
  </body>
</html>
